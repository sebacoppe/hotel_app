{% extends 'base.html' %}
{% block content %}
<h2>Listado de Habitaciones</h2>

<form method="get">
  <label for="estado">Filtrar por estado:</label>
  <select name="estado" onchange="this.form.submit()">
    <option value="">-- Todos --</option>
    <option value="disponible" {% if estado_filtro == 'disponible' %}selected{% endif %}>Disponible</option>
    <option value="ocupada" {% if estado_filtro == 'ocupada' %}selected{% endif %}>Ocupada</option>
    <option value="reservada" {% if estado_filtro == 'reservada' %}selected{% endif %}>Reservada</option>
  </select>
  <label for="tipo">Tipo:</label>
  <select name="tipo" onchange="this.form.submit()">
    <option value="">-- Todos --</option>
    <option value="triple" {% if tipo_filtro == 'triple' %}selected{% endif %}>Triple</option>
    <option value="doble" {% if tipo_filtro == 'doble' %}selected{% endif %}>Doble</option>
    <option value="cuadruple" {% if tipo_filtro == 'cuadruple' %}selected{% endif %}>Cuadruple</option>
    <option value="suite_para_5" {% if tipo_filtro == 'suite_para_5' %}selected{% endif %}>Suite para 5</option>
    <option value="suite_para_7" {% if tipo_filtro == 'suite_para_7' %}selected{% endif %}>Suite para 7</option>
  </select>
  <label for="fecha_entrada">Desde:</label>
  <input type="date" name="fecha_entrada" value="{{ fecha_entrada }}" class="mx-2">

  <label for="fecha_salida">Hasta:</label>
  <input type="date" name="fecha_salida" value="{{ fecha_salida }}" class="mx-2">

  <button type="submit" class="btn btn-primary">Filtrar</button>


</form>

<style>
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 15px;
    margin-top: 20px;
  }
  .card {
    border-radius: 8px;
    padding: 15px;
    color: white;
    font-weight: bold;
    text-align: center;
    position: relative;
    cursor: pointer;
  }
  .disponible { background-color: #2ecc71; }
  .reservada   { background-color: #f1c40f; color: #333; }
  .ocupada     { background-color: #e74c3c; }

  .submenu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: white;
    color: black;
    border: 1px solid #ccc;
    border-radius: 5px;
    width: 100%;
    z-index: 10;
    font-weight: normal;
  }
  .submenu a {
    display: block;
    padding: 8px;
    text-decoration: none;
    color: black;
  }
  .submenu a:hover {
    background-color: #eee;
  }
</style>

<div class="grid">
  {% for h in habitaciones %}
    <div class="card {{ h.estado }}" onclick="toggleSubmenu(this)">
      Hab. {{ h.numero }}<br>{{ h.tipo }}
      <div class="submenu">
        <a href="{{ url_for('reservas.crear_reserva_desde_habitacion', numero=h.numero) }}">üìù Reservar</a>
        <a href="{{ url_for('habitaciones.editar_habitacion', numero=h.numero) }}">üõ†Ô∏è Editar</a>
        <a href="{{ url_for('habitaciones.editar_estado', numero=h.numero) }}">üîÑ Cambiar estado</a>
      </div>
    </div>
  {% endfor %}
</div>

<script>
  function toggleSubmenu(card) {
    const submenus = document.querySelectorAll('.submenu');
    submenus.forEach(s => s.style.display = 'none'); // cerrar todos
    const submenu = card.querySelector('.submenu');
    submenu.style.display = 'block';
  }

  document.addEventListener('click', function(e) {
    if (!e.target.closest('.card')) {
      document.querySelectorAll('.submenu').forEach(s => s.style.display = 'none');
    }
  });
</script>
{% endblock %}
